<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${isEdit ? 'Редактирование контакта' : 'Новый контакт'}"></title>

    <link rel="icon" type="image/png" th:href="@{/images/favicon.ico}"/>

    <!-- Подключение стилей -->
    <div th:replace="~{fragments/styles :: base-styles}"></div>
    <div th:replace="~{fragments/styles :: page-styles('forms')}"></div>
</head>
<body class="bg-light">
<div th:replace="~{fragments/header :: header(${isEdit ? 'Редактирование контакта' : 'Новый контакт'}, null, null, 'contacts')}"></div>

<div class="container">
    <!-- Форма -->
    <form th:action="${isEdit ? '/contacts/' + contactDto.id + '/edit' : '/contacts'}"
          th:object="${contactDto}"
          method="post"
          class="needs-validation" novalidate>

        <!-- Скрытое поле ID для редактирования -->
        <div th:if="${isEdit}">
            <input type="hidden" th:field="*{id}"/>
        </div>

        <!-- Базовая информация контакта -->
        <div th:insert="~{fragments/forms/basic-info-form :: basic-info-form}"></div>

        <!-- Способы связи -->
        <div th:insert="~{fragments/forms/contact-details-form :: contact-details-form(
            detailTypes=${detailTypes},
            detailLabels=${detailLabels}
        )}"></div>

        <!-- Социальные профили -->
        <div th:insert="~{fragments/forms/social-profiles-form :: social-profiles-form(
            platforms=${platforms}
        )}"></div>

        <!-- Компания и должность -->
        <div th:insert="~{fragments/forms/company-job-title-form :: company-job-title-form(
            allCompanies=${allCompanies},
            allJobTitles=${allJobTitles}
        )}"></div>

        <!-- События -->
        <div th:insert="~{fragments/forms/events-form :: events-form(
            eventTypes=${eventTypes}
        )}"></div>

        <!-- Заметки -->
        <div th:insert="~{fragments/forms/notes-form :: notes-form}"></div>

        <!-- Теги -->
        <div th:insert="~{fragments/forms/tags-form :: tags-form(
            allTags=${allTags}
        )}"></div>

        <!-- Действия формы -->
        <div class="d-flex justify-content-between align-items-center py-4">
            <a th:href="@{/contacts}" class="btn btn-outline-secondary btn-lg">
                <i class="fas fa-arrow-left me-2"></i>Назад к списку
            </a>
            <button type="submit" class="btn btn-success btn-lg px-5">
                <i class="fas fa-save me-2"></i>
                <span th:text="${isEdit ? 'Сохранить изменения' : 'Создать контакт'}"></span>
            </button>
        </div>
    </form>
</div>

<!-- Скрытые шаблоны для добавления дополнительных форм -->
<div th:replace="~{fragments/contact-form-templates :: all-templates}"></div>

<div th:replace="~{fragments/footer :: footer}"></div>
<div th:replace="~{fragments/scripts :: base-scripts}"></div>
<div th:replace="~{fragments/scripts :: page-scripts('contact-forms')}"></div>
</body>
</html>